# 实体之间如何传递消息？

## 为什么传递消息

实体之间有时会需要相互传递信息（消息）。典型场景包括：

* 雷达将侦察结果直接传递给打击设备，引导打击设备瞄准目标

* 雷达将侦察结果（消息）传递给指挥控制设备，指挥控制设备对侦察结果进行处理

* 指控设备将指令（消息）传递给打击设备，引导打击设备进行操作


## 消息机制是必须的么？

有没有另外一种方法，可以实现对象之间的信息交互？

消息机制是对现实世界中信息传递方式一种最直观的抽象。


## 消息及其分类

根据上述情况，消息通常具有以下特点：

* 有明确的 **发送者** 和 **接收者**

* 消息的内容是多样的，从形式上要能容纳各种类型的信息


## 消息的传递与处理

### 消息的发送

从使用方式上看，每个实体应该调用一个发送消息方法，就可以将消息发送至当前场景，由当前场景负责将消息转发目标实体.

在这种模式下，场景就相当于一个邮局，发送方只需要将信件（消息）交给邮局，填好信件相关信息，剩下的事由邮局负责处理.

``` python
sender = Entity()
target = Entity()

sender.send_msg(target.name, msg)  # 通过名字发送消息
sender.send_msg(target.id, msg)  # 通过 id 发送消息
sender.send_msg(target, msg)  # 通过对象发送消息
```

### 消息的接收与处理

与消息发送相对应，实体也应该有消息接收和处理接口（方法）。这个方法应该是由场景调用：场景在有需要转发的消息时，调用实体的消息接收/处理接口，通知实体处理消息.

```python
target.recv_msg(sender, msg)
```

为了避免出现消息循环，通常情况下，在消息接收处理过程中，应避免再次发送消息. （TODO: 有没有一种机制，强制再次发送的消息自动放入下一步对应的消息队列中？）


### 消息的时序性



### 接收者的指向性

通常，发送者和接收者是一对一的关系。

还没有确定，是否支持以下关系：

* 一对多

* 全局广播


